---
import { Image } from "astro:assets";
import { getCollection, render } from "astro:content";
import Layout from "@/layouts/Layout.astro";

import headshot from "@/assets/gs-headshot.jpg";

export async function getStaticPaths() {
  const articles = await getCollection("articles");

  return articles.map((article) => ({
    params: { id: article.id },
    props: { article },
  }));
}

const { article } = Astro.props;
const { published, updated } = article.data;
const { Content } = await render(article);

function formatDate(date = new Date()) {
  const options: Intl.DateTimeFormatOptions = {
    month: "short",
    day: "numeric",
    year: "numeric",
  };

  return date.toLocaleDateString(undefined, options);
}
---

<Layout>
  <header class="prose-default my-1 !mb-6 w-full sm:my-2">
    <a
      href="/"
      aria-label="Return home"
      class="flex items-center justify-start gap-4"
    >
      <Image src={headshot} alt="" class="!m-0 size-12 rounded-full" />
      George Song
    </a>
  </header>

  <main class="prose-default mt-0 sm:mt-4">
    <h1>{article.data.title}</h1>

    <time datetime={published.toISOString()}>{formatDate(published)}</time>
    {
      updated ? (
        <>
          (updated{" "}
          <time datetime={updated.toISOString()}>{formatDate(updated)}</time>)
        </>
      ) : null
    }

    <Content />
  </main>
</Layout>
